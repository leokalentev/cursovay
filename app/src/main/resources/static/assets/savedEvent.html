<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Избранные мероприятия</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f4f4; }
        nav { background: #333; padding: 1rem; }
        nav a { color: #fff; margin-right: 1rem; text-decoration: none; }
        nav a:hover { text-decoration: underline; }
        .container { padding: 2rem; }
        .cards {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
          gap: 1.5rem;
        }
        .card {
          position: relative;
          background: white;
          border-radius: 8px;
          box-shadow: 0 2px 6px rgba(0,0,0,0.1);
          padding: 1.5rem;
          display: flex;
          flex-direction: column;
          justify-content: space-between;
        }
        .card h2 { margin: 0 0 0.5rem; font-size: 1.25rem; color: #333; }
        .card p { flex-grow: 1; margin: 0 0 1rem; color: #555; }
        .btn-group { display: flex; gap: 0.5rem; }
        .btn-group button {
          padding: 8px 12px;
          font-size: 0.9rem;
          border: none;
          border-radius: 5px;
          cursor: pointer;
        }
        .view-btn { background: #007bff; color: white; }
        .view-btn:hover { background: #0056b3; }
        .fav {
          position: absolute;
          top: 10px; right: 10px;
          font-size: 1.5rem;
          cursor: pointer;
          color: #e74c3c;
        }
    </style>
</head>
<body>

<nav>
    <a href="home.html">Все мероприятия</a>
    <a href="savedEvent.html">Избранное</a>
    <a href="#" id="logout">Выйти</a>
</nav>

<div class="container">
    <h1>Избранные мероприятия</h1>
    <div class="cards" id="cards-container"><!-- карточки --></div>
</div>

<script>
    const token = localStorage.getItem('token');
    if (!token) location.href = 'login.html';
    document.getElementById('logout').onclick = ()=>{
      localStorage.removeItem('token');
      location.href = 'login.html';
    };

    function getFavs() {
      return JSON.parse(localStorage.getItem('favourites')||'[]');
    }
    function toggleFav(id) {
      const favs = getFavs();
      const idx = favs.indexOf(id);
      if (idx>=0) favs.splice(idx,1);
      else favs.push(id);
      localStorage.setItem('favourites',JSON.stringify(favs));
      loadSaved();
    }

    async function loadSaved() {
      const favs = getFavs();
      const cont = document.getElementById('cards-container');
      if (!favs.length) {
        cont.innerHTML = '<p>Нет избранных мероприятий.</p>';
        return;
      }
      // запрашиваем каждое событие
      const cards = await Promise.all(favs.map(async id=>{
        const res = await fetch(`/api/events/${id}`, {headers:{'Authorization':'Bearer '+token}});
        if (!res.ok) return null;
        return res.json();
      }));
      cont.innerHTML = cards.filter(e=>e).map(e=>`
        <div class="card">
          <div class="fav" onclick="toggleFav(${e.id})">❤</div>
          <h2>${e.title}</h2>
          <p>${e.description||'Описание отсутствует'}</p>
          <div class="btn-group">
            <button class="view-btn" onclick="location.href='showEvent.html?id=${e.id}'">Просмотр</button>
          </div>
        </div>
      `).join('');
    }

    loadSaved();
</script>

</body>
</html>
